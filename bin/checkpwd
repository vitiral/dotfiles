# Usage: sudo checkpwd $USER

echo -n "password for $1:"
read -s password
correct=$(</etc/shadow awk -v user=$1 -F : 'user == $1 {print $2}')
prefix=${correct%"${correct#\$*\$*\$}"}
supplied=$(echo "$password" | perl -e '$_ = <STDIN>; chomp; print crypt($_, $ARGV[0])' "$prefix")

echo ""
if [ $supplied = $correct ]; then
    echo "OK: passwords match"
    exit 0
else
    echo "ERR: passwords do NOT match"
    exit 1
fi
