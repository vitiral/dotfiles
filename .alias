##################################################
# development commands
pathappend() {
    # properly append path to end of PATH
    if [ -d "$1" ] && [[ ":$PATH:" != *":$1:"* ]]; then
        export PATH="${PATH:+"$PATH:"}$1"  # handles case where path is empty
    fi
}

pathinsert() {
    # properly insert path at beginning of PATH
    if [ -d "$1" ] && [[ ":$PATH:" != *":$1:"* ]]; then
        export PATH="$1:$PATH"
    fi
}

function aa_256 () {     local o= i= x=`tput op` cols=`tput cols` y= oo= yy=;    y=`printf %$(($cols-6))s`;    yy=${y// /=};    for i in {0..256};    do        o=00${i};        oo=`echo -en "setaf ${i}\nsetab ${i}\n"|tput -S`;        echo -e "${o:${#o}-3:3} ${oo}${yy}${x}";    done}

alias sudo='sudo '
alias lic_mit="wget -q https://raw.githubusercontent.com/cloudformdesign/licenses/master/LICENSE.MIT -O LICENSE.txt && echo created license"
alias prep="grep '' -n -P -C 2 --exclude-dir '.ropeproject'"
alias pdf="apvlv"
function cless(){
    pygmentize -f terminal "$1" | /usr/bin/less -R
}

## colorize man
man() {env LESS_TERMCAP_mb=$'\E[01;31m' LESS_TERMCAP_md=$'\E[01;38;5;74m'  LESS_TERMCAP_me=$'\E[0m'  LESS_TERMCAP_se=$'\E[0m'  LESS_TERMCAP_so=$'\E[38;5;246m'  LESS_TERMCAP_ue=$'\E[0m'  LESS_TERMCAP_us=$'\E[04;38;5;146m'  man "$@"}

##################################################
# Python

export PYTHONSTARTUP="$HOME/.pythonrc.py"
export PYTHONDONTWRITEBYTECODE=0            # prevents .pyc files

# use the local installation of python first
#python_root="$HOME/software/pyconda/envs"
#py2bin="${python_root}/python2/bin"
#py3bin="${python_root}/python3/bin"
#pathinsert $py3bin
#pathinsert $py2bin
pathinsert "$HOME/.local/bin"
pathinsert "$HOME/bin"

alias py='python3'
alias pyt="py.test --tb short"
alias pytdoc='pyt --doctest-modules'  # don't forget you need to give module path
alias pytdb='pyt -sx --pdb'
alias pdb='py -m ipdb'
alias dbe='py -m cloudtb.dbe'
alias pydev='py setup.py develop'
# http://peterdowns.com/posts/first-time-with-pypi.html
# passwords are stored at .pypirc
alias pypi='py setup.py register -r pypi sdist upload'
alias pypitest='py setup.py register -r pypitest'

alias py2='python2'
alias py2t="py.test --tb short"
alias py2tdoc='py2t --doctest-modules'
alias py2tdb='py2t -sx --pdb'
alias pdb2='py2 -m ipdb'
alias dbe2='py2 -m cloudtb.dbe'
alias py2dev='py2 setup.py develop'

alias py2analyze="pyreverse sf_platform/core/rtfi/ -p dependencies && xdot classes_dependencies.dot &&"
alias pyclean="rm -r ./**/*.pyc"
#alias py2graph="sfood sf_platform/core/rtfi | sfood-graph > graph.dot && xdot graph.dot"

##################################################
# Micro Python
alias upy='micropython'
alias upip='~/projects/micropython/tools/pip-micropython'
# pyboard development
alias pyb="sudo screen /dev/ttyACM0"

##################################################
# Tmux
alias tls="tmux list-sessions"
alias tatt="tmux attach -t"
alias tnew="tmux new -s"
alias trm="tmux kill-session -t"
alias tmv="tmux rename-session -t"  # target-session new-name
alias tkill="tmux kill-server"
alias town="tmux detach -a"  # detach all other sessions from tmux, getting it to correct size

##################################################
# Git
alias gpyignore="wget -q https://raw.githubusercontent.com/github/gitignore/master/Python.gitignore -O .gitignore && echo created python .gitignore file"
alias g='git'
alias gs='git status'
alias gst='git status'
alias gss='git status -s'
alias gd='git diff --color-words'
alias gdc='gd --cached'
alias gdn='gd --name-only'
alias gp='git push'
alias gpo='git push origin'
alias gc='git commit'
alias gca='git commit -va'
alias gcam='git commit -vam'
alias gc!='git commit -v --amend'
alias gco='git checkout'
alias gcm='git checkout master'
alias gcb='git checkout -b'
alias gr='git remote'
alias grls='git remote -v'
alias grmv='git remote rename'
alias grrm='git remote remove'
alias gb='git branch'
alias gbd='git branch -d'
alias gconfig='git config --list'
alias glog='git log --oneline --decorate --color --graph'
alias ga='git add'
#alias gap='git add --patch'
#alias gaa='git add --all'
alias gm='git merge'
alias ghash='git rev-parse HEAD'

gitio() {
    curl -i http://git.io -F "url=$1"
}

## Sign and verify commits with GPG
#alias gcs='git commit -S'
#alias gsps='git show --pretty=short --show-signature'

## Sign and verify tags with GPG
#alias gts='git tag -s'
#alias gvt='git verify-tag'


# Mercurial
alias hs='hg status'
alias hd='hg diff --color always | less -R'
alias hp='hg push'
alias hc='hg commit'
alias hcam='hg commit -m'
alias hlog='hg log -G --color always --template "{label(\"custom.rev\", node|short)} - ({label(\"custom.decorate\", branch)}) {desc|strip|firstline} ({label(\"custom.date\", date|age)}) <{label(\"custom.author\" , author)}>" | less -R'
alias hm='hg merge'


##################################################
# Networking
ipscan() {
    sudo nmap -sn $1/24 | grep 'Nmap scan report for'
}

alias netinfo='echo "## netstat -nr:" && netstat -nr && echo "## ifconfig:" && ifconfig | pcregrep -M "(eth0|wlan0)\s+Link.*\n\s+inet"'

# File System
alias dd="dcfldd"
alias untar="tar -zxvf"

# automatically move ssh public credentials into authorized_keys of system connecting with
ssh_autoauth() {
    tmp_keys="/tmp/${USER}_tmpauthkeys"
    ssh_keys="~/.ssh/authorized_keys"
    command="cat > $tmp_keys && mkdir -p ~/.ssh && cat $tmp_keys >> $ssh_keys && sort -u $ssh_keys > $tmp_keys && mv $tmp_keys $ssh_keys"
    cat ~/.ssh/id_rsa.pub | ssh $1 $command
    ssh "$@"
}

reconnect() {
    if ip link | grep wlp2s0; then
        sudo systemctl restart netctl-auto@wlp2s0.service
    else
        echo "Umm... What is wlan again>"
    fi
}


##################################################
# OS specific aliases

alias paclean='sudo pacman -R $(pacman -Qdtq)'
if [[ `uname` == 'Darwin' ]]; then
    alias vim='/Applications/MacVim.app/Contents/MacOS/Vim'
    alias minicom=/opt/minicom/2.2/bin/minicom
elif [[ `uname` == 'Linux' ]]; then
    # arrow keys are bound to moving words. Use cntrl to 
    bindkey "^L" forward-word
    bindkey "^H" backward-word
    setxkbmap -layout us -option ctrl:nocaps >> /dev/null
elif [[ `uname` == 'Cygwin' ]]; then
    :  # pass, none yet
fi

if [[ -e ~/.alias.local ]]; then
    source ~/.alias.local
fi

